# Fast Packet IO library in User Space (FastIO User -> fastio_user) #

This library is developed for **low-level prototyping** and **teaching** innovative and high-performance Virtualized
Network Functions (VNFs) with data plane frameworks in the Linux's **user space**. Since this library is used for my PhD
research and teaching purposes, it focus on the **simplicity**. Different from high performance virtual switch/router
frameworks like [BESS](https://github.com/NetSys/bess) or [VPP](https://github.com/FDio/vpp), this library is target at
building the virtual network function program running normally INSIDE a container or VM. According to the SDN/NFV
design, this network function is responsible to handle ONLY a subset of flows that are filtered and redirected by the
virtual switches. Compared to the filtering/routing/redirecting functions provided by virtual switch, these VNFs perform
more complex tasks that require more computational power like DPI, NAT, video transcoding or payload compression etc.
The FastIO User supported VNFs should only handle **virtual** network interfaces (like virtio-user, vhost, veth, tun/tap
etc.).

FastIO User currently focuses on providing DPDK C wrappers that can be used to speed up packet I/O and processing with
more programmer friendly APIs and utility functions. It is designed for evaluating/benchmarking latest features of DPDK,
and prototyping novelty VNF ideas in a virtualized environment. It is not developed for production usage, use good
frameworks like [NFF-GO](https://github.com/intel-go/nff-go), [libmoon](https://github.com/libmoon/libmoon) or
[Netbricks](https://github.com/NetSys/NetBricks) instead.

## Build Shared Library ##

In order to simplify and the build process on different platforms. The Docker container is suggested to build the
library (To avoid "I could not build this on my laptop due to dependency errors etc"). There is a
[Dockerfile](./Dockerfile) and a [Python3 script](./util/run_dev_container.py) to automate the build process. Make sure
you have Docker CE installed. The container image and shared library (.so file) can be built with following steps.
(Because the DPDK is compiled from the source code, the step of build the container image takes time, -j can be modified
in the Dockerfile to speed up the compiling time.)

```bash
$ cd ./util/
# Build the DPDK development docker container image
$ ./run_dev_container.py build_image
# Run make INSIDE the development container
$ ./run_dev_container.py build_lib
```

By default, the compiled shared library (libfastio_user.so) is placed in ./build/ directory.

## Dependencies ##

The dependencies are planned to managed by the Dockerfile. The versions are marked here clearly to avoid confusion.

- DPDK: v18.11 LTS

## Tests and Examples ##

DPDK should be configured properly before running tests and examples. Detailed setup guide can be found in the DPDK's
official [quick start setup guide](https://doc.dpdk.org/guides/linux_gsg/quick_start.html). FastIO User's tests and
examples use a run.sh script with AF_PACKET driver configured for the device. No device binding is required. The
hugepages can be created by running `sudo ./util/setup_hugepage.sh`. By default, 1GB hugepages is allocated.

**MARK**: All required setups are automatically configured for the VNF VM described in ../Vagrantfile after each boot:
`vagrant up vnf`. So you can run tests and examples in this development VM directly after boot.

- Run tests in the development container (without interaction) with:

```bash
$ cd ./util/
# Run development container in interactive mode
$ ./run_dev_container.py run_test
```

## Documentation ##

The documentation is generated by [Doxygen](http://www.doxygen.nl/). Build and open the HTML documents with:

```bash
$ make docs
$ xdg-open docs/html/index.html
```

## Reference Frameworks ##

>  TODO:  <28-06-19, Zuo> Put reference section into a separate file > 

Some tricks and low level optimizations are learned from several high-performance packet I/O and processing frameworks
and integrated into fastio_user. These frameworks are awesome, but are relative too heavy, hide many tunable parameters
or have some limitations to simply integrated with data processing frameworks (e.g. Using OpenCV's python bindings to
process images easily). Therefore, I planed to built this light library.

- [VPP](https://wiki.fd.io/view/VPP/What_is_VPP%3F): The VPP platform is an extensible framework that provides out-of-the-box production quality switch/router functionality.

    1. Vectorized processing to avoid L1 cache misses and use a efficient prefetch mechanism.

- [Natasha](https://github.com/scaleway/natasha): Natasha is a fast and scalable, DPDK powered, stateless NAT44 packet processor.
